# C 标准库

> 语言规范定义的用于丰富语言功能的标准库，下载编译器时自动下载
>
> 之所以称为标准库，是因为C语言保证在不同的平台这些标准库函数和变量具有相同的行为。

# 0. 概念

### 0.1 命名规范

* 标准库中定义的只供标准库中其他函数所使用的的名字都以下划线开头，所以一般不会与用户程序中的名字冲突。
* 供用户使用的函数就是常规命名，不以下划线开头。

# 1. I/O

> 输入输出是程序与环境之间交互的一部分
>
> 使用IO库函数需要包含<stdio.h>文件

### 1.1 IO相关抽象

#### 1.1.1  文本流

> 文本流是由多行字符构成的字符序列，而每行字符则由0个或多个字符组成，行末是一个换行符。
>
> 标准库IO部分负责使每个输入/输出流能够遵守这一模型。
>
> 使用标准库的C语言程序员不必关心在程序之外这些行是如何表示的。

* 字符流

  * 总之标准库给IO提供一个抽象，那就是一个输入字符流，一个输出字符流
  * 总之就是抽象成流(stream)
  * 我们关心这个模型就行了，其他一律不管。
* 区分输入流中的文件
  * 在没有输入或文件结束时，IO函数将返回一个特殊值，这个特殊值与任何实际字符都不同。
  * 这个值称为EOF(End Of File)，也是C语言标准库定义的一个值

#### 1.1.2 缓冲区

* 概念
  * 标准IO输出到屏幕，输入来自键盘
  * 文件IO输出到文件，输入来自文件，文件存储在硬盘中
  * CPU和键盘，屏幕，硬盘之间速度差异巨大，不可能长时间等待IO，所以常常利用缓冲区。
  * 在内存中建立输入缓冲区和输出缓冲区，实际IO时，CPU从输入缓冲区读数据，输出也输出到输出缓冲区。
  * CPU IO完成后去干别的了，然后系统再慢慢填充输入缓冲区，将输出缓冲区内容真正输出到相应位置。

#### 1.1.3 文件描述符、文件指针和文件句柄

* 不管什么系统，系统给程序提供读写文件的IO系统调用。
* Unix系统调用通过文件描述符读写文件
* Windows系统调用通过文件句柄读写文件。
* 因为C标准库是跨平台的，所以标准库IO接口是固定的
  * 但是具体实现就是在什么系统调用什么系统的IO系统调用。
  * 所以标准库IO接口抽象出文件指针来读写文件实现跨平台，

### 1.2 标准I/O函数

##### 0.概念

* 标准IO指针对stdin, stdout,stderr的函数，即从标准输入读取输入，输出到标准输出或标准错误输出。
* 本质其实也是对文件的IO，只不过C语言预先定义了stdin，stdout,stderr这三个文件指针。

##### 1.IO函数

> 这里只是简单介绍，详情自行参见C语言标准或者查看C程序设计语言书的附录-标准库部分

###### getchar

* ```int getchar(void)```
  * 从stdin中一次读取一个字符，遇到文件结束，返回EOF


###### putchar

* ```int putchar(int)```
  * 将字符输出到stdout


###### gets

* 读取一行

###### puts

* 输出一行

###### printf

> 格式化输出函数

* ```int printf(char*format, arg1,arg2,...)```

* 用途

  * 在输出格式串format的控制下，读取参数内容进行转换和格式化并输出到stdout。

* format格式串

  * 组成

    * 普通字符
      * 原样输出
    * 转换说明
      * 指示如何格式化对应的参数

  * 转换说明(规范)

    * 转换说明必须和参数一对一。
    * 转换说明结构
      * %开始...中间若干内容...转换字符结束
        * 中间若干内容可以都省略,或者省略部分
        * 中间若干内容按顺序分别是:
          * 负号——指定左对齐
          * 宽度数——指定打印宽度，空格填充
          * 小数点——分隔宽度数和精度数
          * 精度数——指定字符串打印的最大字符数,浮点数小数点之后的位数,整数最少输出的数字数目。
          * 字母h,l——h表示整数作为short类型打印，l(小写L)表示将整数作为long类型打印

  * 转换字符

    > 只列出常用的几个，详细见书附录

    * | 字符 | 参数类型   | 输出形式                         |
    | ---- | ---------- | -------------------------------- |
    | d    | int型      | 十进制数                         |
    | o    | int型      | 八进制数(无前导0)                |
    | x,X  | int        | 16进制数，无前导0x或0X           |
    | c    | int        | 单个字符                         |
    | s    | char*      | 打印字符串直到'\0'或指定打印精度 |
    | f    | double     | 十进制小数                       |
    | p    | void*      | 打印指针(形式取决于具体实现)     |
    | %    | 不转换参数 | 打印%本身                        |

###### scanf

>  格式化输入函数

* ```int scanf(char *format, ...)```

* 作用
  * 从stdin得到输入然后根据格式串形式赋值给参数，相当于在printf相反的方向提供同样的转换功能。


* 注意

  * 参数必须是指针形式

    * ```c
      int d;
      scanf("%d",&d);
      ```
    
  * scanf读取时会忽略所有空白符(空格，横向纵向制表，回车换行，换页符)

* format格式串


  * 组成


    * 空白符被忽略
    * 普通字符(不包括%),用于匹配输入流中的字符
    * 转换说明(规范)

  * 转换说明(specifiction)


    * 转换说明必须和指针参数一对一。
    * 结构
    
      * %开头--[中间内容]--转换符号
      * 中间若干内容可以都省略,或者省略部分
      * 中间若干内容按顺序分别是:(这里不写了，很少用，用的时候再补充吧)

  * 转换符

    > 只列出常用的


    * | 符号  | 参数类型 | 输入数据                     |
      | ----- | -------- | ---------------------------- |
      | d     | int*     | 十进制整数                   |
      | i     | int*     | 八进制(0开头)或16进制(0x,0X) |
      | c     | char*    | 字符                         |
      | s     | char*    | 字符串                       |
      | e,f,g | float*   | 浮点数                       |
      | %     | 无       | 匹配字符%                    |


### 1.3 字符串IO函数

##### 0. 概念

* 字符串IO函数指函数从字符串读取输入，输出到字符串

##### 1. IO函数

###### int sprintf(char * string, char*format, arg1,arg2,...)

* 跟printf用法一模一样，唯一的区别是sprintf输出到字符串string。

###### int sscanf(char* string, char* format, arg1,arg2,...)

* 跟scanf用法一模一样，唯一的区别是sscanf从字符串读取输入。

### 1.4 文件IO函数

##### 0.概念

* 打开文件
  * 读写文件必须首先打开文件
  * 使用fopen打开文件，返回一个用于文件读写操作的指针。
* 文件指针
  * fopen返回的用于文件读写的指针就叫做文件指针
  * 文件指针指向一个包含文件信息的结构，这些信息包括:缓冲区的位置，缓冲区中当前字符的位置，文件的读或写状态，是否出错或是否已经达到文件结尾等，用户无需关心这些细节。
  * <stdio.h>已经定义了文件类型FILE,只需FILE*声明文件指针，然后用fopen返回的指针赋值，然后就可以读写文件了。
* 标准IO文件指针
  * 启动一个C语言程序时，操作系统环境负责打开3个文件，并将这三个文件的指针提供给该程序。
  * 这三个文件分别是标准输入，标准输出，标准错误输出，相应的文件指针分别为stdin,stdout,stderr.
    * 这三个文件指针都是常量指针。
  * 所以完全可以通过文件IO函数实现标准IO，只需指定读写文件为标准IO对应的文件指针就行了。

##### 1.IO函数

###### fopen

* ```FILE * fopen(char *name, char* mode)```

* 以mode指定的模式打开文件，返回文件指针供IO函数读写操作。

###### fclose

* ```int fclose(FILE *p)```
  * 断开由fopen函数建立的文件指针和外部名之间的连接。
  * 释放文件指针以供其他文件使用。
    * 因为大多数OS都限制了一个程序可以同时打开的文件数，所以当文件指针不再需要时就应该释放。
  * 刷新输出缓冲区，即将内容写到文件。

###### getc

* ```int getc(FILE *fp)```
  * 从fp所指文件中读取一个字符

###### putc

* ```int putc(int c, FILE *fp)```
  * 将字符c写入到fp指向的文件

###### fscanf

* ```int fscanf(FILE *fp, char *format,...)```

###### fprintf

* ```int fprintf(FILE *fp, char  *format,...)```
  * 文件格式化输入输出函数，用法完全同scanf,printf只不过输入输出源换为文件。

###### fgetc

* ```char *fgets(char *line, int maxline, FILE *fp)```
  * 从文件中读取一行

###### fputs

* ```int fputs(char *line, FILE *fp)```
  * 一行输出到文件

# 2. 变长参数表

* 形式
  * int print(char *fmt, ...)
  * 省略号表示参数的数量和类型是可变的，省略号只能出现在参数表的尾部。
* 库函数
  * 处理变长参数的关键在于如何处理一个甚至连名字都没有的参数表
  * C<stdarg.h>头文件包含了一组宏定义，它们对遍历参数表进行了定义。

# 3. 其他函数

## 3.1 字符串处理函数

* <string.h>

| 函数           | 描述         |
| -------------- | ------------ |
| strcat(s,t)    | concatenate  |
| strncat(s,t,n) |              |
| strcmp(s,t)    | compare      |
| strncmp(s,t,n) |              |
| strcpy(s,t)    | copy         |
| strncpy(s,t,n) |              |
| strlen(s)      | length       |
| strchr(s,c)    | char         |
| strrchr(s,c)   | reverse char |

* s,t字符串，n整型值，c字符

## 3.2 字符类别测试和转换函数

* <ctype.h>

* | 函数       | 描述 |
  | ---------- | ---- |
  | isalpha(c) |      |
  | isupper(c) |      |
  | islower(c) |      |
  | isdigit(c) |      |
  | isalnum()  |      |
  | isspace(c) |      |
  | toupper(c) |      |
  | tolower(c) |      |

## 3.3 命令执行函数

* <stdlib.h>

###### system(char *s)

* 执行包含在字符串s中的命令，然后继续执行当前程序。
* s的内容很大程度上取决于所使用的OS。
  * system("ls")

## 3.4 存储管理函数

* <stdlib.h>

###### malloc

> memory allocate

* ```void *malloc(size_t n)```
  * 动态分配存储块，返回一个指针指向nB长度的未初始化的存储空间。

###### calloc

* void * calloc(size_t n, size_t size)
  * 动态分配存储块，返回一个指针指向的空闲空间足以容纳由n个指定长度的对象组成的数组。

###### free(p)

* 释放p指向的存储空间，其中p是通过调佣malloc或calloc函数的到的指针。
* 存储空间的释放顺序没有什么限制，但是，如果释放一个不是通过调用malloc或calloc函数得到的指针所指向的存储空间，将是一个很严重的错误。

## 3.5 数学函数

* <math.h>

* | 函数       | 描述                        |
  | ---------- | --------------------------- |
  | sin(x)     |                             |
  | cos(x)     |                             |
  | atan2(y,x) |                             |
  | exp(x)     |                             |
  | log(x)     |                             |
  | log10(x)   |                             |
  | pow(x,y)   |                             |
  | sqrt(x)    | square root 平方根          |
  | fabs(x)    | float absolute 浮点数绝对值 |

  * 以上x,y均为double类型

## 3.6 随机数发生器函数

###### rand

* ```int rand()```
  * 产生一个0~RAND_MAX之间的伪随机整数
    * RAND_MAX定义在<stdlib.h>的符号常量，取值至少是32767

###### srand

* ```void srand(unsigned int seed)```
  * srand函数将seed作为生成新的伪随机数序列的种子数。种子数的初值为1.

