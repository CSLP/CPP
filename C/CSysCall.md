# C语言使用Unix系统调用

> 系统调用就是操作系统提供给用户程序的函数。
>
> C语言程序可以直接使用系统调用来完成一些标准库函数完不成的任务，或者更高效的完成任务。

# 1. IO

### 1.1 关键抽象

* 文件描述符。

  > fd   file descriptor

  * 通常情况下，在读或写文件之前，必须先将这个意图通知系统，该过程称为**打开文件**。
  * 如果打开文件一切正常，OS将向程序返回一个小的非负整数，该整数称为**文件描述符**。
  * 任何时候对文件的IO都是通过文件描述符标识文件，而不是通过文件名标识文件。
    * 文件描述符类似标准库中的文件指针或Windows系统中的文件句柄。
  * 系统负责维护已打开文件的所有信息，用户程序只能通过文件描述符引用文件

* 0,1,2

  * 当shell运行一个程序的时候，它将打开三个文件，对应的文件描述符分别为0,1,2,
  * 依次表示标准输入，表述输出，标准错误输出。

### 1.2 IO系统调用

> 系统调用没有单独的标准IO函数，所有的IO都是通过文件描述符方式读写。
>
> 区别是shell提前打开了stdin,stdout,stderr,所以不用我们显式打开，读写其他文件需要显式打开。

###### read

* ```int read(int fd， char *buf, int n)```
  * 读取文件描述符所指文件的n个字节到buf中


###### write

* ```int write(int fd, char *buf, int n)```
  * 取buf中的n个字节到文件中

###### open

* ```int open(char *name, ing flags, int perms)```
  * 打开name所指文件，返回文件描述符
  * flags指定读写模式， perms指定权限相关信息

###### create

* ```int create(char *name, int perms)```
  * 创建文件或覆盖已有文件，返回文件描述符

###### close

* ```int close(int fd)```
  * 关闭文件释放文件描述符
  * 一个程序同时打开的文件数是有限制的(通常为20).相应地，如果一个程序需要同时处理许多文件，那么它必须重用文件描述符。

lseek

> 随机访问
>
> read/write是顺序读写文件

* ```long lseek(int fd, long offset, int origin)```
  * 系统调用lseek可以在文件中任意移动位置而不实际读写任何数据。

# 2. 文件系统

# 3. 存储分配